<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Touch ID</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Welcome to My Touch ID</h1>
    </header>

    <main>
        <section id="add-book-form">
            <h2>Please Fill This Form Accordingly</h2>
            
            <div class="contact-right">
                <form name="submit-to-google-sheet">
                    <input type="text" name="Name" placeholder="Your Name" required>
                    <input type="tel" name="Phone" placeholder="Your Phone" required pattern="^[0-9]{10}$" title="Please enter a valid 10-digit phone number">
                    <textarea name="Message" rows="6" placeholder="Your Message"></textarea>
                    
                    <button type="submit" class="btn btn2">Submit</button>
                    <button id="nextButton" class="button1" style="display: none; margin-top: 20px;">Next</button>
                </form>

                <span id="msg">Hello</span>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 Scanner. All rights reserved.</p>
    </footer>

    <script>
        // Google Sheets script URL for form submission
        const scriptURL = 'https://script.google.com/macros/s/AKfycbwxb8f2N-2xeiz_N1m7hr3KMvWMzGVpjp6XA58J_c8XCVTE08Hgn4ZeN2fkyoSsrf4I1Q/exec';
        const form = document.forms['submit-to-google-sheet'];
        const msg = document.getElementById("msg");
        const nextButton = document.getElementById("nextButton");

        // Check if the form has expired
        const expirationTime = 30 * 60 * 1000; // 30 minutes in milliseconds
        const startTime = sessionStorage.getItem('startTime') || Date.now();
        sessionStorage.setItem('startTime', startTime);

        function checkExpiration() {
            const currentTime = Date.now();
            const elapsedTime = currentTime - startTime;
            if (elapsedTime >= expirationTime) {
                msg.innerHTML = "Sorry, this form has expired.";
                form.querySelectorAll("input, textarea, button").forEach(element => {
                    element.disabled = true;  // Disable form inputs
                });
                setTimeout(() => {
                    window.location.href = "expired.html";  // Redirect to an expiration notice page after 5 seconds
                }, 5000);
            }
        }

        // Run the expiration check immediately and then every minute
        checkExpiration();
        setInterval(checkExpiration, 60000);

        form.addEventListener('submit', e => {
            e.preventDefault();  // Prevent the default form submission

            // Submit the form data to Google Sheets
            fetch(scriptURL, { method: 'POST', body: new FormData(form) })
                .then(response => {
                    if (response.ok) {
                        msg.innerHTML = "Message sent successfully";
                        nextButton.style.display = "block";  // Show the "Next" button

                        nextButton.addEventListener('click', function() {
                            window.location.href = "finger.html";  // Redirect to finger.html
                        });

                        setTimeout(function(){
                            msg.innerHTML = "";
                        }, 5000);

                        form.reset();
                    } else {
                        throw new Error('Form submission failed.');
                    }
                })
                .catch(error => {
                    console.error('Error!', error.message);
                    msg.innerHTML = "Error sending message. Please try again.";
                });
        });
    </script>
    <script src="script.js"></script> 
</body>
</html>
